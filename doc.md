  Build a simple chat bot with messenger  platform  but before we jump into coding let's  take a look at the bot we will build  this is a facebook page which i already  embed a chat bot behind it  if i send a text message i will have a  reply message immediately  asking for sending an image this bot can  handle the text message  and attachment message let's send an  image to this bot  we have a reply message with two buttons  to confirm  one yes and one no these are post back  buttons  and the bot also sends message if i  click on these buttons  my aim  is that everyone  can familiar with the chatbot messenger  concepts  we do everything from scratch to make it  easy to learn and understand then  finally  we can build complex spots like restaurant bots . so you will learn how to create a facebook  page then a facebook app  after that deploy a webhook with node.js  platform  finally at the end you can  build a simple chatbot  to handle text and attachment messages  let's get started now   we will create a facebook  page together  so first go to facebook and log in with  your registered account  this is the facebook homepage to start  we will create a facebook page in the  left corner of the screen  we choose pages this is the screen  showing all the pages  that you have created so far to create a  new page  we have two ways option one click on  this plus button  then select page or we can directly  click on this button  create new page here we need to fill up  information  such as pages name and category  i will choose shopping and retails then  write a brief description  and press create page button we will  have a pop-up below  saying the new page creation was  successful  next we need to update the avatar as  well as the cover image for this new  page  let's wait a moment for facebook to  upload photos  for the cover image you can drag to  choose the desired angle  then click the save button to complete  the process of creating a new page  this is the fan page that we just  created  the next thing we need to do is to add a  button on the page  so that users can send messages to this  page  click on add a button by default  facebook will give us a lot of options  such as buy gift card button  order food and so on however  we will not choose these options because  we are building the chatbot  right here we will choose send message  after adding the button to send the  message successfully  immediately the original button has  changed to edit button  we will check if our button is working  for a page about shopping and retail  facebook has already suggested a few  sample messages for us  i will choose the first sample message  to check the messages sent to the fan  page  on the left corner we need to select the  inbox  because i press control plus click a new  tab  opened this is the interface to manage  all messages sent to fanpage  you can send reply messages to users in  this box  we got the response messages it means  that  the fan page is working properly you can  also choose delete conversation to  restart this conversation again  you need to know that suggested sample  messages appear only for new customers  who have never sent a message to the  page  so  you already learn how  to create a facebook page previously we learned how to  create a facebook page for a chat bot . we will learn how to  create a facebook app  the facebook app is where we connect to  the facebook page  which we created earlier and with the  facebook app  we can use the facebook apis to send  messages to users  to create a facebook app we will need a  facebook developer account  going to facebook developer this is the  facebook developer page  by default this page only shows  information about facebook products  so we need to log in as a facebook  developer  to login to this page we will use a  facebook account  we will log in with the same facebook  account which we used to create a  facebook  page before this is the facebook  developer interface after logging in  at this page click on my apps  immediately we will redirect to the  dashboard  showing all the facebook apps that this  facebook account has created so far  to create a new facebook app you can  click directly to this blue button  or you can hover the mouse on the  facebook avatar then select  create app before creating a facebook  app  facebook will ask what is our purpose to  use this app  because we are building the chat bot for  the facebook page  so we'll choose the first option we will  need to enter the name of the facebook  app  with the facebook policy remember that  the name of the app  will not contain keywords which related  to facebook  next is to choose the purpose of the app  and finally  select create app id wait a moment for  facebook to create the app  we will have to complete the security  check  facebook need to know that we are not  robots  click submit to complete the process if  you are redirected to this screen  congratulations you have successfully  created a new facebook app  the name of the facebook app will appear  here  so we will know which facebook app we  are using  to build the chat bot we will need the  messenger platform  so we will add messenger product to this  app  click the setup button  the left bar has updated messenger  product  next we will set up a few basic  configurations for this product  first we will need to link this facebook  app  to a facebook page click add or remove  page choose to continue with your  facebook account  select the facebook page which we  created earlier  select next and finally done wait a  moment for facebook to process our  request  if we successfully link the facebook app  and facebook page  the name of the facebook page will  appear in this section. Then we will set up a  node.js server  then config the facebook webhook. we will build a node.js server to handle  messages for chat bots  first let's create an empty folder on  the computer  this directory is where we store the  source code of this node.js server  next we will open up the visual studio  code  here let's open the empty folder which  we just created  select file followed by the open folder  find the folder where you will write  this project code  the folder we have opened up with the  visual studio code  is a completely empty folder we will  build everything from scratch  to open a terminal in the visual studio  code  on the keyboard press control plus  backtick  or in the toolbar select view then  select the terminal  before we jump into coding there are a  few things you need to keep in mind as  follows  first of all our computer has installed  the node.js  environment you can test it by doing the  same what i did  if your computer has not installed the  node.js environment  you can also install it by going to  google  typing download node.js we will choose  the first search result  here depending on the operating system  you choose the version of node.js that  is suitable for your computer  after you have downloaded node.js you  install it  it's very simple after we have installed  the node.js environment  we proceed to create a node.js project  for the chatbot  to create a new node.js project we use  the command  npm in it package name  we keep the default press enter to  continue  version 1.0 description  write a briefly describe for this  project  facebook messenger chatbot entry point  is the file we will run the server i  will change to server.js  because simply i don't like the index.js  file  press enter to continue author  write your name here after finishing  this process  immediately we will have the  package.json file in the root directory  this file is where we manage the  javascript libraries used in the project  to start writing code we will install  the following packages  the first is express a back-end  framework  the second is the view engine ejs  next comes the dot env and finally the  body parser  after we finish the installation our  project has added node modules folder  and packagelock.json and the names of  the packages we install also appear here  i will proceed to create a structure for  our project  first we will create a folder named src  short for source code this is where we  write the source code for the project  inside this directory we create an entry  point file  server.js we will need a configuration  folder  this is where we configure system  parameters such as view  engine session or database connection  view folder to store the view files  the controller directory that handles  the requested logical requests  public folder to store public files  such as css javascript at client side  and images  services directory will receive  connection to facebook apis  then return the result first  we will configure the view engine for  the system  in the config directory create a file  name config view  engine in this file we will import  express framework  then create an arrow function named  config view engine  we will export this function to use  later  module.exports the name of the function  you want to export  in this function we will pass the input  parameter  is the express app we will config  express app  to use a static link that is the public  directory  where we store the images css and  javascript files  in addition we also configure the view  engine as ejs  and finally where we store the ejs files  is the view directory app.set  views then the path to the destination  you store the view files  in this case is the views folder  after that in the public folder we  create the following directory  css to write stylesheet files  js for javascript and images  to store images we use in this server  next in the src directory we will create  one more folder  roots this is where we declare the roots  used in the system  create a new file name web we will  define all the web roots in this file  similar to the view engine we will also  use express for routes  impert express from express  after that we will define a router  variable  use express router  we create a function to store web routes  don't forget to export this function  module.exports  the name of the function you want to  export  in this function we return to a default  value that is  every route on the server always begins  with a slash  we will define the router to return the  home page we use the method get  router.get the root then the server  action  we define a function with request and  response as two input parameters  and then execute a callback function  use response.send to send a message  this function will simply return a hello  world string  ctrl s to save changes  after that we will configure the entry  point file  server.js in order to run the node.js  server  our server will run this file first  first  we will import the express framework  after that  we will configure the server parameter  such as the view engine  declare the routes in the server as well  as convert the data sent to the server  as aj sun object by using the body  parser package  we will import the view engine from the  config directory  then import all web routes from the  roots directory  we create an instance of express  after that configure ejs as the view  engine  to use body parser we use the syntax  app use body parser then call json  function  body parser dot url encoded then  extended is true the extended syntax  allows for rich objects and arrays to be  encoded into the url  encoded format allowing for a json like  experience with url encoded  we will declare the routes used on this  server  add a comment then call the init web  roots function  then pass the express app as the input  parameter  to run the local server we need to  create a variable  named port this variable will get the  value from the environment file  if in case we have not declared in the  environment file  this variable will take the value of  8080.  we will call express's listen method to  run the local server  on the port we specified if we run the  server successfully  this function will execute a callback  function where we simply print out a  message  saying that our app is running at the  port we defined before  by default express will not understand  the process.env syntax  in order to get the values of the  variables in the dot env file  we will use the dot env package  require.env at the  beginning of this file  to run the project we will use the  command  node followed by the path to the entry  point file  we get this error saying that the  node.js server doesn't understand the  import syntax  or in other words the import syntax is  invalid  the import syntax is the syntax used in  es6 and later versions  while require is javascript's es5 syntax  to be able to use the syntax of  different versions of javascript  we will need a server-side compiler here  we will use the babel package  first at the root directory we create  the following files  git ignore file to be able to push the  necessary files in the project to github  env an env.example are files that store  environment variables  babel rc is the babel compiler  configuration file  we will install the following packages  so that we can compile the javascript  syntax for different versions  we install node mon to make the node  server automatically restart  whenever it's detected we have file  changes  then install babel compiler including  babel core  babble node and babel preset env  wait a few minutes to this process to  complete  let's set up the babel compiler we will  change the babel rc  file in this file we will use the  following syntax  create an object with the key set to  presets  its value is an array here we will use  babel preset envel  after the installation is complete the  package.json file will update to add the  newly installed packages  we will add a command to run the node.js  server  first we define the command start  here we will use the node mon execute  babel node  and call our entry point file  to run the server we use the command npm  start here we used nodemon  and the server was running successfully  to test  let's open up the web browser type  localhost address port 8080.  we will get hello world message so  we succeed to setup and run a node.js  server  the last thing we need to do is to fill  up the environment files  we start with the dot env to comment  we use the hashtag then the comment  configure the app variables . we have already defined  the port parameters in the entry point  so create this variable we set its value  to 8080.  then copy this file and paste  to.env.example  we won't push the dot env to github for  security reasons  we only push this file after we have  installed the node.js server  the next thing we will do is to build  the facebook chat bot  to start we will read the documentation  of the messenger platform  which helps us to understand the  mechanism and how to operate a chatbot  with facebook messenger  here on the left side of the screen we  will choose getting started  and after that we have the next option  to build everything from scratch  according to this document we can start  with a project available on github  or remix it on glitch but here  i will choose to build from scratch to  better understand this platform  at the start first we will need to  configure the facebook app  previously  i showed you how  to create a facebook app  as well as linking the facebook app to  the facebook page  if you do not know then you can review above.  right here we will reopen our facebook  app  select my apps followed by choosing the  app you created  you can check the name of the app here  next  in the left corner of the screen in the  product section  we choose messenger then setting  here we can see the facebook page has  been successfully linked to this app  at this point we will generate a token  the purpose of this token is to allow us  to send messages to facebook users  who sent messages to our facebook page  here we check this box and choose to  copy the token  reopen our project  in the dot env file we will create a new  variable  to store the facebook page token name it  the page access token then paste the  value we copied here  next we create a new variable name it my  verify  token this is the token that facebook  will use to authenticate our web hook  this token is for us to decide it is a  string  so feel free to set a value for it  next in the example file we will create  two new variables we just created  the first variable is the page access  token  and the second is the my verify token  but in this file we will not update  their values  we go back to facebook's docs after  creating the facebook app  we have created a facebook access token  to send message to facebook users  we have also saved this token as an  environment variable to use in the  future  the next thing we need to do will be  configuring facebook webhook  these are the three basic functions we  will use for chat bots  the first function will handle text  messages  the next function is to handle events  when the user selects the buttons in our  messages  and the last one is how to send the  message with the facebook apis  however before we get started i will  refine our code  first we will start with declaring the  roots  in the roots directory open the web file  previously  i have  instructed you to return hello world  message  if the user gets the home page this is  not wrong  but we are processing app's logic on the  view layer  we will split the model view and  controller into three separate parts  here in the controller directory we  create a new file  named chatbot controller this file will  be responsible for handling requests for  chatbot  let's create a function so we can get  the home page  creates an arrow function named test  with two input parameters  request and response  in this function we use response.send  to return a message to the user  to use this function we will export it  instead of exporting a function i will  export an object  with the key and its value as the same  we will export the function test  ctrl s to save changes return to the web  roots file  first of all we will import the  controller  to handle the request the user sent  import chatbot controller from  controller  we use 2 dot to go back to the root  folder  then go to the controller folder and the  controller file  next we will delete this part instead  the controller name and the function to  handle user requests  with this we will handle logic at the  controller file  while the view simply selects which  controller file to handle the request  save changes and re-run the server if i  reload the page  the result will be different from the  original  instead of hello world we received a new  message  the new message has appeared  successfully proving our system is  working properly  from now on we will build the chat bot  following the mvc model  view to display the user interface  controller for handling logic  and the model to connect data to the  database  in this project our model is the  services  responsible for connecting to the  facebook apis  next i will define two new functions  the first function is get webhook using  the get method  the next function is postwebhook using  methodpost  we will use two functions later for each  function  we all pass two parameters request and  response  as input parameters after that  we will export these two functions for  using in other files  copy the name and update it here ctrl  s to save changes next  we need to declare two new routes for  the newly created functions  the first will be the get method for the  webhook root  we will use the chatbot controller then  call the getwebhook function  which we created to process requests for  this route  next is the post method we also use the  chatbot controller  and call the post webhook function  basically  we have all the tools needed to  configure the facebook webhook  go back to facebook documents  we also copy these three functions and  paste them into our chatbot controller  go back to the chatbot controller file  we need to update this file  i will close these other tabs we only  open the editing file  paste these functions right below the  post webhook function  here we scroll to the top of this page  facebook has also dedicated a section to  guide webhook configuration  select webhook setup in this section  facebook shows us step by step to  configure a facebook web hook  to make it easier to understand imagine  that  a facebook web hook is the bridge  between facebook  and our node.js server when a user sends  a message to our facebook page  facebook server will send signals to  webhook  the node.js server will listen for  facebook signals on the webhook  handle the request and choose a response  then call the facebook apis to send a  reply message to the user  the steps in the requirement section are  done already  we created a node.js project created an  http server  with express framework we have also  added the facebook endpoint in this  server  here all we need to do is write the code  for them as well  copy this block of code i will later  explain the content of this code  then update our post webhook function  we will paste the block code right here  in the body of this function  next we also update the get webhook  function  to verify the web hook we copy this  block code  and update the get webhook function  we paste the block code right here i  want to format our code to make it  easier to see  to do that select the block code  then right-click select format section  to format the block code you want  now it looks better in this function  we have one parameter that needs to be  updated  which is the verify token we will get  the verify token value  from the environment file dot env  so import.env package  next we create a constant here we name  it my verify token  its value we get from the environment  file with the syntax  process.env  update the verify token parameter its value is my verify token  so what happens when we call this get  webhook function  first the server node.js will parse the  query parameters  get the mode token and challenge  parameters that we pass in the url  if we have mode parameter and token  parameter  then mode equals subcribe and token is  my verify token  we will log the webhook verify message  and return status 200.  otherwise we will return status 403  forbidden if verify token is not match  so how to test this web hook scroll to  the test your web hook section  right here we will use a curl to test  the facebook web hook  we will copy this curl command then open  notepad  on your computer open notepad then paste  the command you copied before  here we need to change a few parameters  for this test statement  change port to 8080. next  we need to update verify token parameter  here we will open the dot env file  then copy the value of the my verify  token parameter  replace to your verify token copy this  curl command  and open up visual studio terminal press  the shortcut  control back tick to open the terminal  this terminal is running our node.js  server  so click on this plus icon to open  another  paste to the terminal and press enter  we get an error that the powershell of  visual studio  cannot understand the curl command this  is because  the visual studio code does not support  this command  to fix it we will use git bash  first we need to open the folder where  we write the source code this project  in the root folder right click then  select  git bash right-click then paste the curl  command  and press enter we get the error  forbidden  this is telling that the verify tokens  do not match  the reason for this error is because of  the node.js server  cannot get the variables in the  environment file  we must put the environment files in the  root folder  including.env env.example  git ignore and babelrc to do  that open the project folder and move  these files  to the root folder same level with the  src folder  we try again we still get this error  we need to restart the node.js server to  know the new environment files  i will console.log the verify token to  see if we can get this token or not  you can see the nodemon has already  restart the server for us  open the git bash and try again  we have a new message challenge accepted  this time we succeed  previously we succeeded in  authenticating the facebook web book  the next work we need to do is to deploy  this webhook to a web server  in this tutorial i choose deploy to  herica cloud  because it meets the requirements of  facebook like providing an ssl  certificate for the web hook  and we can use herica for free to get  started  first we need to create a new file  called procfile  in the root folder name it proc file  we need to click outside these files to  be able to create a file in the root  directory  proc file is the file that helps hiraku  know how to run our server  in this file we will use web  colon node to run a web app  followed by the path to our entry point  file  here will be the server.js file in the  src directory  press ctrl s to save the changes  next we will create a haraku app to  deploy this  application going to heroku.com  because i'm already logged in haraku  automatically redirects me to the  dashboard  which manages all the haraku apps i've  created so far  if this is your first time using haraku  then this is haraku's interface  you will need an account to use haraku  in this screen  you can choose to create a free account  or register a new account  create a haraku account you need to fill  out the following  information such as first name last name  and email address email address  is your username to login to haraku and  one more note  that you choose node.js here finally  press the create account button once you  have a hariku account  to be able to manage our apps locally  you need to install the haraku cli  haroku cli helps us to view application  logs  and run applications locally. Back to our application to be able to  create a new haraku app  you choose new then create new app  we will need to set a name for this app  and choose the region for this  application  one thing you need to know is that the  name of the haraku app  shouldn't contain keywords related to  facebook because this is a violation  to facebook policy for using facebook  products  here we are using messenger product  finally  press the button create app if you  successfully create the app  the name of the haraku app will appear  here  and haraku also guides us on how to  quickly deploy an application to haraku  at this section we will need to log in  to haraku  you can use the visual studio code  terminal or using git bash  we use the command haraku login then  press  enter press any key on the keyboard to  continue  herika will automatically open a new tab  on the browser  you press the button login immediately  our status has changed to logged in if  the login is successful  your herika username will appear in the  terminal  the next step is to create a git  directory  in order to push the source code to  haraku  copy this command like me the command  right below get in it  this time i will use visual studio code  first we will use the git init command  to be able to manage the source code  with git  after that you paste the command you  just copied here  the purpose of this command is to set  git remote to haraku  or in other words to help us push the  code to haraku  instead of github next we proceed to  push the code onto haraku  first select the files to deploy then  commit the same way you would with  github  i use git add a space and dots to be  able to select all the files in this  project  finally use the command git push harika  master  wait a moment for the application  deployed to haraku  this usually takes a few minutes  depending on the speed of your internet  connection  as well as the size of the application  to be deployed .To view our haraku app click on this  link on the terminal  or on haraku you choose open app  since this is our first time running the  app we need to wait a moment for harika  to start our app  so our app has failed to run in order to  see what error we are having  we need to look at logs of haraku with  this command  we'll copy this command and paste it in  the terminal  press enter wait a moment for  harikawright logs  here you can see that our app has  started successfully  because of we have the message app is  running at the port 8080.  however the application encountered a  timeout error  because herica could not find a  parameter our port number  to fix this error first reopen our entry  point file  server.js  here you need to capitalize the name of  the environment parameter  after that we need to redeploy the app  to haraku  press control c to exit the running  process  since we are working with the haraku  server there is no need to run the  node.js server locally  git add then git commit finally  git push harika master since we are not  pushing the dot env file on haraku  nor can haruka read the dot env file we  will need to configure these environment  parameters for haraku  in the haraku app interface we select  settings  then reveal config variables the first  parameter we need to configure  is the port set its value to 8080  followed by the page access token  copy name and paste here  we also copy the value of this parameter  the last parameter is my verify token  add to finish after we have configured  the environment parameters  as well as our app has deployed to  haraku we reload our app  this time we were successful the  application deployed to haraku  was the same as when we ran it locally  displaying the message hello again  after deploying the app to haraku the  next thing we need to do  is configure the webhook for our  facebook app after we have successfully  deployed the webhook to herica cloud  the next thing we will do is configure  the facebook app  to use this webhook here we choose  setting up your facebook app before we  get started  let's check out what we did we create a  facebook page  then use the facebook account to log  into the facebook developer  then create a facebook app at the same  time  we have also deployed a webhook node.js to haraku server  so now we had a webhook url  so basically we have successfully  configured the facebook app  here to move to the next section you can  click on the onward to the quick start  or in the sidebar we can click directly  on this quick start section  previously  we have also  configured the facebook app  as well as generate the facebook page  access token.After we have built the facebook webhook  we will find a way to get the id of the  person  who sent the message to our fan page  this id  is called psid short for page scope id  so what is psid a person  is assigned a unique page scoped id for  each facebook page they start a  conversation with  the psid is used to identify a person  when sending messages  here we will copy this body back to our  project  we will update the post webhook function  in the chatbot controller  paste the code we copied into this body  i will explain this post webhook  function  when a user sends a message to the  facebook page  facebook will send events to this  webhook  if it was an event sending a message to  the fan page we would get this event  object  then print a sender psid at the same  time  we responded to facebook with status  200.  in case it's not an event sent to the  fan page the server node.js will respond  with a 404 not found status  to test if our webhook is working we  will redeploy the app to haraku  if our app is running when the user  sends a message to the facebook page  we will see the id of the person who  sent the message  while waiting for the app to deploy to  haraku we will configure the facebook  app to use the web hook  which we deploy to haraku we will open  the facebook app  here i am in the settings section of the  messenger product  we scroll to the web hooks section  select add callback url  callback url is your haraku app link  then slash webhook and what is verify  token  this is our my verify token parameter  copy the value of this parameter and  paste it here  so what did facebook do when we press  the button  verify and save first facebook will send  a get request to our webhook  the node.js server on haraku with the  get method  and the endpoint slash webhook the  server node.js will call the getwebhook  function  in this function we will check for the  parameter  my verify token here we send the correct  verify token  so node.js will respond with status 200  so facebook knows that our webhook is  active  and it will accept this webhook  finally click verify and save  wait a moment for facebook to confirm  our request  if you successfully configured the  webhook the link of the webhook will  appear here  the next step is to register to receive  events from facebook  here we will subscribe to the following  events  messenging to receive user messages sent  to fanpage  we use standby and messaging handovers  events  to turning on off the chat bot  messaging post back events will occur  when a post back button  get started button or persistent menu  item is tapped  next we will enable natural language  processing for chat bots  select the facebook page then enable  this toggle  i will mention natural language  processing feature for chat bots  after we have configured the webhook for  the facebook app  it's time to check if this web hook  works or not  going back to our code the application  has successfully deployed to haraku  at the same time we also open a tab to  see the haraku logs  we have webhook verify message because  just earlier  we have authenticated webhook with  facebook  to check please open the facebook page  then send a message to your fan page  then check herico logs  we got the id of the person who sent the  message to facebook page  at the same time this is the content of  the message we received  after getting the id of the person who  sent the message to the facebook page  the next thing we will do is to send a  response message  to the user with this id returning to  the facebook's documentation  we are familiar with the page scope id  also known as the sender id  in order to be able to send messages to  users  we will be familiar with facebook events  these events will be sent to our web  hook  letting us know if the user has sent a  text message  an image or a sticker generally  the messenger platform sends webhook  events to notify you of actions  that occur in messenger in this function  we will check the names of events which  facebook sent to the web hook  if it was a messaging event we would  call the message handler function  opposite if it is the event sending the  post back  we will call the post backhandler  function  at the same time in these two functions  we also pass the event  and the sender id to the handler  functions  next we will write code for these two  functions  copy this function and overwrite our  function  we copy this block code then go back to  the ide  we overwrite the handle message function  here we create a variable called  response  we will check if the message sent is a  text message or not  because it is possible that users send  pictures  stickers not text messages  we will attach an object to the response  variable  including the response message finally  we call the send api to send the message  we will write the send api function now  copy function send api and overwrite our  function  in the call send api function first  we need to create a request body object  including the recipient id and the text  response  next we make a http request to send the  message to facebook user  we copy this block code then go back to  the ide  in this function we use the page access  token parameter  this is why in the webhook setup for the  facebook app  we created this token this token  parameter is required  always passed on the facebook page api  time to send your first message with the  messenger platform  send api in handle message  we are calling call send api so now we  need to update it  to construct the full request body and  send it to the messenger platform  a request to the send api has two  properties  recipient sets the intended message  recipient  in this case we identify the person by  their psid  message sets the details of the message  to be sent  here we will set it to the message  object  which we passed in from our handle  message function  in this quick start we are using the  node.js request module  for sending http requests back to the  messenger platform  to install the request module run npm  install request from the command line  then import it to the top of this file  in order to use the request package we  import the request package  import request from request then  go back to the call send api function  we will update the facebook api version  right here we use the newest version 7.0  in messenger send another text message  to your facebook page  you should receive an automated response  from your messenger experience  that echoes back your message and  prompts you to send an image  since our response prompts the message  recipient  to send an image our next step is to  update our code to handle an attachment  your messenger experience can send and  receive  most asset types including images  audio video and files  to determine if the message is an  attachment update the conditional in  your handle message function  to check the received message for an  attachments property  then extract the url for it in a real  world bot  we would iterate the array to check for  multiple attachments  but for the purpose of this quick start  we will just get the first attachment  next we will respond to the image with a  generic template message  the generic template is the most  commonly used structured message type  and allows you to send an image text and  buttons in one message  you can copy this block code like me or  copy the whole function  then replace our function i copy the  part to create a response message  we paste the block code right here this  is a generic template message  allows us to send text and buttons at  the same time  we have two buttons to send to the users  one yes and one no the yes  and no buttons are calling post back  button  the payload property is the button id  we use the payload to know which button  users interact  our last step is to handle the messaging  postbacks webhook event  that will be sent when the message  recipient taps one of the post back  buttons in our generic template  since our generic template allows the  message recipient  to choose from two postback buttons we  will respond  based on the value of the payload  property of the postback event  to do this update your handle postback  stub to the following  to test what we did we will deploy the  code to haraku  if everything went well you just  finished building your first messenger  experience  in this function we simply check the  payload message  if the payload equal yes we send a text  response  saying thank you otherwise send a text  response saying to send another image  finally we call the send api function  to send the response message to the  facebook user  after we succeed to deploy the project  to haraku  now it time to test our chatbot  open your facebook fan page first  we will send a text message if our bot  is working  it will send a reply message immediately  including our text message  and asking for sending an image try  again with another text message  the message reponse structure always the  same because we only build a simple bot  without using natural language  processing  next we will send an image choose a  random image from your computer  then send to the bot wait a moment for  the bot receives the image  as you can see we have a generic message  including the image we sent and two  buttons  yes and no let click on the no button  we have a reply message and the yes  button  a thank you message our bot is working  really simple.